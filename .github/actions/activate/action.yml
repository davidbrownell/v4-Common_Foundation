# ----------------------------------------------------------------------
# ----------------------------------------------------------------------
# ----------------------------------------------------------------------
#
# This file is the result of a code generation process; any changes made
# to this file will be overwritten during the next code generation
# invocation. Any changes MUST be made in the source file rather than in
# this one.
#
#     Code Generator:         Jinja2
#     Input Filename:         actions/activate/action.jinja2.yml
#     Generated Date:         2022-11-08 09:57:42.479716
#
# ----------------------------------------------------------------------
# ----------------------------------------------------------------------
# ----------------------------------------------------------------------

# ----------------------------------------------------------------------
# |
# |  action.yml
# |
# |  David Brownell <db@DavidBrownell.com>
# |      2022-10-28 10:56:24
# |
# ----------------------------------------------------------------------
# |
# |  Copyright David Brownell 2022
# |  Distributed under the Boost Software License, Version 1.0. See
# |  accompanying file LICENSE_1_0.txt or copy at
# |  http://www.boost.org/LICENSE_1_0.txt.
# |
# ----------------------------------------------------------------------
name: Activate
description: Runs `Activate` on the repository.

inputs:
  repo_dir:                                 {type: string, required: true}
  os:                                       {type: string, required: true}
  configuration:                            {type: string, required: true}
  shell_name:                               {type: string, required: true}

outputs:
  activate_statement:
    description: The command to activate the environment that can be used by other composite actions.
    value: ${{ steps.activate_statement.outputs.result }}

runs:
  using: composite
  steps:
    - name: Activate Statement
      id: activate_statement
      uses: actions/github-script@v6
      with:
        result-encoding: string
        script: |
          var activate_statement;

          if("${{ inputs.os }}".startsWith("windows")) {
            activate_statement = "pushd \"${{ inputs.repo_dir }}\" && Activate.cmd";
          } else {
            activate_statement = "pushd \"${{ inputs.repo_dir }}\" > /dev/null && . ./Activate.sh";
          }

          if("${{ inputs.configuration }}" != "None") {
            activate_statement += " ${{ inputs.configuration }}";
          }

          activate_statement += " --debug";

          return activate_statement;

    - name: Activate
      run: ${{ steps.activate_statement.outputs.result }}
      shell: ${{ inputs.shell_name }}

    - name: Results
      run: |
        echo "Activate Statement: ${{ steps.activate_statement.outputs.result }}"
      shell: ${{ inputs.shell_name }}
